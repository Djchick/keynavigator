/*!
 * Key navigator plugin for jQuery / Zepto.
 *
 * https://github.com/nekman/keynavigator
 */
(function(root,factory){"use strict";if(typeof exports==="object"){module.exports=factory(require("jquery"))}else if(typeof root.define==="function"&&root.define.amd){define("keynavigator",["jquery"],factory)}else{factory(root.jQuery||root.Zepto)}})(this,function($){var defaultEventHandlers={click:function(){$.isFunction(this.options.click)&&this.options.click.apply(this,arguments)},enter:function(){$.isFunction(this.options.enter)&&this.options.enter.apply(this,arguments)},down:function(){var len=this.$nodes.length-1;if(this.options.cycle){if(this.index>=len){this.index=-1}}if(this.index<len){this.index++}this.setActive()},up:function(){if(this.options.cycle){if(this.index<=0){this.index=this.$nodes.length}}if(this.index>0){this.index--}this.setActive()}};var KeyNavigator=function($nodes,$parent,settings){var options=settings||{};this.options=$.extend({},this.defaults,options);this.options.keyMappings=$.extend({},this.defaults.keyMappings,options.keyMappings);this.options.activeClassName="."+this.options.activeClass;this.index=-1;this.selector=$nodes.selector;this.$nodes=$nodes;if(!$parent.attr("tabindex")){$parent.attr({tabindex:this.options.tabindex||-1})}this.$parent=$parent};KeyNavigator.prototype={defaults:{useCache:true,cycle:false,activeClass:"active",keyMappings:{38:"up",40:"down"},click:function($el){this.setActiveElement($el)}},handleKeyDown:function(e){var handler=this.options.keyMappings[e.keyCode];if(!handler){return}if(!this.options.useCache){this.$nodes=$(this.selector)}var $selected=this.$parent.find(this.options.activeClassName);if(this.index<0){this.index=$selected.index()}var fn=$.isFunction(handler)?handler:defaultEventHandlers[handler];if(!fn){throw new Error("Could not find any function for keyCode: "+e.keyCode)}fn.apply(this,[$selected,e])},setActive:function(){var $selectedNode=this.$nodes.eq(this.index);this.$nodes.removeClass(this.options.activeClass);$selectedNode.addClass(this.options.activeClass)},setActiveElement:function($el){var index=$el.index();if(index===this.index){this.$nodes.removeClass(this.options.activeClass);this.index=-1;return}this.index=index;this.setActive()}};$.fn.keynavigator=function(options){var $parent=this.parent(),navigator=new KeyNavigator(this,$parent,options);this.bind("click",function(e){defaultEventHandlers.click.apply(navigator,[$(this),e])});$parent.bind("keydown",$.proxy(navigator.handleKeyDown,navigator)).bind("click",function(){$parent.focus()});return this};return $});